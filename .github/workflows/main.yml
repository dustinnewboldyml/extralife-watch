name: Slack Product Review Notifier

on:
  pull_request:
    types: [ labeled ]

jobs:
  build:
    if: ${{ github.event.label.name == 'bug' }}
    runs-on: ubuntu-latest

    steps:
    - name: Dump GitHub context
      id: github_context_step
      run: echo '${{ toJSON(github) }}'
    - name: Dump job context
      run: echo '${{ toJSON(job) }}'
    - name: Dump steps context
      run: echo '${{ toJSON(steps) }}'
    - name: Dump runner context
      run: echo '${{ toJSON(runner) }}'
    - name: Dump strategy context
      run: echo '${{ toJSON(strategy) }}'
    - name: Dump matrix context
      run: echo '${{ toJSON(matrix) }}'

    - uses: actions/checkout@v2
    - name: Notify Slack
      run: |
        curl -X POST \
        -H 'Content-type: application/json' \
        --data '{
          "text": "A new PR is available for product review",
          "blocks": [
            {
              "type": "header",
              "text": {
                "type": "plain_text",
                "text": "${{ github.ref_name }}"
              }
            },
            {
              "type": "section",
              "text": {
                "type": "mrkdwn",
                "text": "A new PR is available for product review"
              }
            },
            {
              "type": "actions",
              "block_id": "actions1",
              "elements": [
                {
                  "type": "button",
                  "action_id": "view_pr",
                  "text": {
                    "type": "plain_text",
                    "text": "View PR"
                  },
                  "url": "https://www.example.com"
                }
              ]
            }
          ]
        }' \
        ${{ secrets.SLACK_WEBHOOK }}
